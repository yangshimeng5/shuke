<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        table{
            width: 80%;
            border: 1px solid black;
            border-color: black;
            text-align: center;
        }
        tr,td{
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <h1>用户列表</h1>
    <table>
        <thead>
             <tr>
                <td>用户名</td>
                <td>用户电话</td>
                <td colspan="2">操作</td>
            </tr>
        </thead>
        <tbody id="data">
            <tr>
                <td></td>
                <td></td>
                <td><a href="#">删除</a></td>
            </tr>
        </tbody>
    </table>
    <script>
        window.onload=function(){
            let xhr=new XMLHttpRequest();
            xhr.onreadystatechange=function(){
                if(xhr.readyState===4 && xhr.status===200){
                    let rows=JSON.parse(xhr.responseText)
                    let tbody=document.getElementById("data");
                    let html=""
                    for(let i=0; i<rows.length;i++){
                    html+=`
                        <tr>
                            <td>${rows[i].uname}</td>
                            <td>${rows[i].phone}</td>
                            <td><a href="">详细信息</a></td>
                            <td><a href="javascript:del(${rows[i].uid})">删除</a></td>
                        </tr>`;
                    }
                    tbody.innerHTML=html
                };
            };
            xhr.open("get","http://127.0.0.1:8080/ajax/userlist",true);
            xhr.send();
        }
        // 完成用户删除操作
        // 1创建函数
        function del(uid){
            // alert(uid)
            let rs=confirm("是否删除指定用户？")
            if(!rs){
                return
            }
            let xhr=new XMLHttpRequest();
            xhr.onreadystatechange=function(){
                if(xhr.readyState===4 && xhr.statusText===200){
                    if(xhr.responseText==1){
                        location.reload(true)
                    }else{
                        alert("删除失败")
                    }
                }
            }
            let url=`http://127.0.0.1:8080/ajax/restful_del/${uid}`;
            alert(url);
            xhr.open("delete",url,true);
            xhr.send();
        }
    </script>
</body>
</html>