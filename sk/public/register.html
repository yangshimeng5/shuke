<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/register.css">
</head>
<body>
    <div id="head">
        <div id="center">
            <img src="./img/logo.png" alt="" >
        </div>
    </div>
    <div id="main">
        <div id="tatil">
            <h3>买书就到书客，超值！</h3>
        </div> 
        <form action="/v1/users/reg" method="POST"></form>
        <div id="reg">
           
                <h2>用户注册</h2>
                <ul>
                    <li>
                        用户名：<input type="text" name="uname" id="uname">
                    </li>
                    <li>
                        密码：<input type="password" name="upwd" id="upwd">
                    </li>
                    <li>
                        邮箱：<input type="text" name="email" id="email">
                    </li>
                    <li>
                        手机：<input type="text" name="phone" id="phone">
                    </li>
                    <li id="lia">
                        <a href="login.html">已有账号？返回登录</a>
                    </li>
                    <li>
                        <input type="button" value="注册"  id="but" onclick="reg()">
                    </li>
                </ul>
        </div> 
    </form>
    </div>
    <footer>
        <ul>
            <li><img src="./img/legal.png" alt="" ></li>
            <li><img src="./img/invoice.png" alt=""></li>
            <li><img src="./img/service.png" alt="" ></li>
        </ul>
    </footer>
    <script>
        function reg(){
            let reg1=/^[a-zA-Z0-9]{3,12}$/;
            let reg2=/^[a-zA-Z0-9]{3,12}$/;
            let reg3=/^1[3-9]\d{9}$/;
            let msg=document.getElementById('msg');
            let uname=document.getElementById("uname").value;
            let upwd=document.getElementById("upwd").value;
            let email=document.getElementById("email").value;
            let phone=document.getElementById("phone").value;
            // 验证正则表达式
            // 用户名验证
            if(!reg1.test(uname)){
                alert("用户名格式有误");
                return;
            };
            // 验证密码
            if(!reg2.test(upwd)){
                alert("密码格式有误");
                return;
            };
            if(!reg3.test(phone)){
                alert("手机格式有误")
                return;
            };
            // 创建Ajax对象
            let xhr=new XMLHttpRequest();
            xhr.onreadystatechange=function() {
                if (xhr.readyState===4 && xhr.status===200){
                    let obj=JSON.parse(xhr.responseText);
                    // alert(xhr.responseText);
                    if(obj.code===200){
                        alert("注册成功");
                        location.href="./login.html"
                    }
                }
            }
            // 绑定状态修改事件
            let url="http://127.0.0.1:8080/v1/users/reg";
            // alert(url)
            xhr.open("post",url,true);
            xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            //发送
            // alert(uname)
            let formdata=`uid=null&uname=${uname}&upwd=${upwd}&email=${email}&phone=${phone}`;
            xhr.send(formdata);
        }
    </script>
</body>
</html>